# napari-mobilesam 快速入门指南

本指南将帮助您快速上手使用 napari-mobilesam 插件。

## 基础操作流程

### 1. 启动 napari 和插件

```bash
# 启动 napari
napari
```

在 napari 界面中:
- 点击 `Plugins` 菜单
- 选择 `MobileSAM Segmentation`

### 2. 加载图像

有两种方式加载图像:

**方式1**: 通过 napari 界面
- 点击 `File` 菜单 -> `Open File(s)`
- 选择您要分割的图像文件

**方式2**: 拖放文件
- 直接将图像文件拖放到 napari 窗口中

### 3. 设置图像

在 MobileSAM 插件面板中:
- 从下拉列表中选择您的图像图层
- 点击 `设置当前图像` 按钮

### 4. 添加标注

选择标注模式:
- `点标注`: 适合精确标记目标
- `框选标注`: 适合快速框选目标区域

#### 点标注模式:
1. 选择 napari 中的 Shapes 图层（如果没有，插件会自动创建）
2. 使用 `Add Points` 工具在目标上添加点
3. 所有点默认为前景点（标签为1）

#### 框选模式:
1. 选择 napari 中的 Shapes 图层
2. 使用 `Add Rectangles` 工具在目标周围绘制矩形

### 5. 执行预测

- 确保已添加点或矩形标注
- 点击 `执行分割预测` 按钮
- 稍等片刻，模型会生成分割掩码

### 6. 查看结果

- 掩码结果将显示在叠加在原图上
- 如果生成了多个掩码候选（默认开启），可以从下拉列表中选择最佳掩码

### 7. 保存结果

有多种保存方式:
- 点击 `添加到Labels图层` 按钮将掩码添加到标签图层
- 点击 `保存当前掩码` 将当前选中的掩码保存为文件
- 点击 `保存所有掩码` 将所有候选掩码保存为文件

## 批处理功能

要批量处理多张图像:

1. 切换到 `批处理` 选项卡
2. 设置输出目录和命名规则
3. 添加图像到处理队列
4. 点击 `处理队列中所有图像` 开始批处理

## 示例

最简单的使用方式是运行示例脚本:

```bash
python examples/demo.py
```

这将加载一个示例图像并启动插件。

## 提示与技巧

- **提高精度**: 添加更多的前景点可以提高分割精度
- **处理速度**: 在 Mac M 系列芯片上，MPS 后端将自动用于加速推理
- **保存设置**: 批处理标签页中的设置（如输出目录、命名规则）会在会话中保持
- **图像尺寸**: 较大的图像可能需要更多处理时间，考虑在预处理中调整大小

## 常见问题解答

**Q: 模型加载很慢怎么办?**  
A: 首次加载模型需要下载权重文件，请确保网络连接良好。之后的启动会更快。

**Q: 为什么我的掩码结果不够准确?**  
A: 尝试添加更多的标注点，或者尝试框选模式。

**Q: 如何处理多个对象?**  
A: 对每个对象分别进行标注和预测，然后添加到Labels图层，不同对象会有不同的标签值。 